---
title: "Gather and Clean Contrast Sensitivity (Abramov)"
author: "Rick Gilmore"
date: "`r Sys.time()`"
output: 
  html_document:
    self_contained: no
    code_folding: hide
params:
  this_csv_fn:  "~/Box\ Sync/Project_Sex_difference_on_Motion_Perception/data/contrast_sensitivity_task_data/csv/2019111309492663_contrast_sensitivity_task.csv"
  this_sub_id: "2019111309492663"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
```

## Purpose

This script imports, summarizes, and shows basic visualizations of an individual's session data.

## Report for `r params$this_sub_id`

## Import

```{r}
s_data <- readr::read_csv(params$this_csv_fn)
```

```{r}
s1_clean <- s_data %>%
  mutate(., correctAns = stringr::str_extract(correctAns, "left|down|right|up")) %>%
  mutate(., corr = if_else(resp == correctAns, 1, 0)) %>%
  rename(., contr = loop_trial.intensity,
         trial_n = loop_trial.thisN)

s1_subset <- s1_clean %>%
  dplyr::select(., Participant, Gender,
                trial_n,
                contr,
                correctAns,
                resp,
                corr,
                resp.rt) %>%
  dplyr::filter(., trial_n >= 0) %>%
  dplyr::mutate(run = rep(1:4, each=30))
s1_subset
```

## Visualize

```{r contrast-sensitivity-by-trial}
s1_subset %>% ggplot(.) +
  aes(x = trial_n, y = contr) +
  facet_grid(. ~ run) +
  geom_smooth() +
  geom_point() +
  ggtitle("Contrast sensitivity data")
```

### Cumulative performance across runs

```{r contrast-sensitivity-cum-p}
s1_subset <- s1_subset %>%
  dplyr::group_by(., run) %>%
  dplyr::arrange(., contr) %>%
  dplyr::mutate(., cum_sum = cumsum(corr),
                cum_p = cum_sum/n())

s1_subset %>% ggplot(.) +
  aes(x = contr, y = cum_p) +
  facet_grid(. ~ run) +
  geom_point() +
  geom_smooth(se = FALSE) +
  ggtitle("Contrast sensitivity data")
```


```{r contrast-sensitivity-rt}
s1_subset %>%
  ggplot(.) +
  aes(x = trial_n, y = resp.rt) +
  facet_grid(. ~ run) + 
  geom_point() +
  ggtitle("Contrast sensitivity data")
```
