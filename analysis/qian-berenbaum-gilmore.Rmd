---
title: "Analyses for write-up"
author: "Yiming Qian & Rick Gilmore"
date: "`r Sys.time()`"
css: report.css
output: 
  html_document:
    self_contained: false
    code_folding: hide
    toc: true
    toc_depth: 2
    toc_float: true
params:
  data_path: "~/Box/Project_Sex_difference_on_Motion_Perception/data/processed_data"
  hobby_data_path: "~/Box/Project_Sex_difference_on_Motion_Perception/data"
  csv_fn: "combined_2021-04-30.csv"
  outlier_sd_thresh: 3.0
---

# Purpose

This document shows our analyses following the preregistered plan.
It also shows the results of trimming all cases whose scores on either of the visual perception measures exceed `r params$outlier_sd_thresh` SDs from the pooled mean.

# Setup

Set chunk options and load libraries.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(sjPlot)  # create publishable table
library(pwr)
library(Hmisc)
library(ggpubr)
library(ggExtra)
library(mixtools)
library(mediation)
library(gridExtra)
```

# Import and clean

We import data previously cleaned to remove cases where accuracy is lower than the guess rate and any zero scores in the survey measures. 

```{r load}
# load the data and make each variable right
df1 <- readr::read_csv(file.path(params$data_path, params$csv_fn)) 
```

## Exclude outliers

We detect outliers `r params$outlier_sd_thresh` SD from the grouped mean.

```{r}
# define a function to remove outliers
FindOutliers <-
  function(data,
           sd_thresh = as.numeric(params$outlier_sd_thresh)) {
    sd = sd(data, na.rm = T)
    mean = mean(data, na.rm = T)
    # we identify extreme outliers
    extreme.threshold.upper = (sd * sd_thresh) + mean
    extreme.threshold.lower = -(sd * sd_thresh) + mean
    result <-
      which(data > extreme.threshold.upper |
              data < extreme.threshold.lower)
    print(result)
  }

outliers <- lapply(df1, FindOutliers)
outliers
```

Exclude the outliers and create a new data frame.

```{r}
df2 <- df1
df2$contrast_thr[outliers[['contrast_thr']]] <- NA
df2$motion_dur_thr[outliers[['motion_dur_thr']]] <- NA

df2 <- df2 %>%
  dplyr::mutate(.,
                log_contrast = log(contrast_thr),
                log_motion = log(motion_dur_thr))
# df2 <- df1[-c(outliers[['contrast_thr']], outliers[['motion_dur_thr']]),] # we cannot use this code, because there is overlap in the outliers of these two threshold. It will delete one good data.
```

```{r}
str(df2)
df2$Age <- factor(df2$Age, levels = 1:4, labels = 1:4)
```

# Demographic information

Are there differences in participant demographics by sex?

```{r}
chisq.test(df2$Sex, df2$Age)
chisq.test(df2$Sex, df2$School_year)
table(df2$Sex, df2$Handedness)
chisq.test(df2$Sex, df2$Handedness)

chisq.test(data.frame(hispanic = c(5, 1),
                      non = c(96, 29)))

chisq.test(data.frame(
  asian = c(37, 11),
  cas = c(49, 14),
  afric = c(13, 3),
  Pacificislander = c(1, 0),
  no = c(1, 2)
))
```

The male and female samples appear comparable.

# Pregistered analysis plan

See <https://aspredicted.org/5iv9a.pdf>

> To examine how individual differences of visual perception measures are associated with other tasks, we will use correlations within sex. The lower visual perception threshold is, the higher perceptual sensitivity this individual has. In both sexes, we expect to find negative correlations between visual perception measures and spatial ability and masculine hobbies, but no significant correlation with verbal ability. There are four planned correlations (two visual perception tasks × two cognitive tasks) within sex, for a total of eight. This project is a novel study that has not to our knowledge been conducted previously. So we have consciously decided to maintain strict control of Type II error, in order to have enough statistical power to detect a small correlation effect sizes (r=0.20) within the constraints of sample size. This decision to maximize the power (.80) leads to a trade-off between Type I and Type II error. We plan to conduct eight separate one-tailed correlation tests with Type I error at 0.05 and no Bonferroni correction. With a critical p value of .05, around 150 participants are required for each group to detect an effect size of 0.20 at an obtained power of 0.8 with a one-tailed correlation test.

Because our preregistration envisioned a much larger total sample, we have chosen to report the correlations by sex as planned and also for the combined sample.

We select the variables for our correlation analysis, and drop incomplete cases.

```{r}
df_corr <- df2 %>%
  dplyr::select(Sex,
                Age,
                log_contrast,
                log_motion,
                mental_rot,
                vocab,
                Masculine_hobbies,
                Feminine_hobbies,
                femscale,
                masscale)

df_complete <- df_corr[stats::complete.cases(df_corr), ]

# Set the number of digits to display in the tables
options(digits = 2)
```

This gives us $n=$ `r dim(df_complete)[1]` complete cases.

We note that case 78 has threshold measures for motion and contrast but no data from the mental rotation, vocabulary, or hobbies measures.

```{r}
df_complete_F <- df_complete %>%
  dplyr::filter(., Sex == 'Females')
df_complete_M <- df_complete %>%
  dplyr::filter(., Sex == 'Males')

df_corr_F <- df_corr %>%
  dplyr::filter(., Sex == 'Females')
df_corr_M <- df_corr %>%
  dplyr::filter(., Sex == 'Males') 
```

## Compute one-tailed correlations

### Females

```{r}
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$mental_rot,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$masscale,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$femscale,
  method = "pearson",
  alternative = "greater"
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$mental_rot,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$masscale,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$femscale,
  method = "pearson",
  alternative = "greater"
)
```

#### One-tailed regression

```{r}
mod <- lm(mental_rot ~ Age + log_contrast, data = df_complete_F)
res <- summary(mod)
# For the two-sided hypotheses
2 * pt(-abs(coef(res)[, 3]), mod$df)
# For H1: beta < 0
pt(coef(res)[, 3], mod$df, lower = TRUE)

mod <- lm(mental_rot ~ Age + masscale, data = df_complete_F)
res <- summary(mod)

mod <- lm(log_contrast ~ Age + masscale, data = df_complete_F)
res <- summary(mod)

mod <- lm(log_motion ~ Age + masscale, data = df_complete_F)
res <- summary(mod)

mod <- lm(log_contrast ~ Age + masscale, data = df_complete_M)
res <- summary(mod)
mod <- lm(log_motion ~ Age + masscale, data = df_complete_M)
res <- summary(mod)
```


```{r}
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$mental_rot,
  method = "pearson",
  alternative = "less",
  na.action = na.exclude
)  # for 'cor' function, use="pairwise.complete.obs"the cases with missing values are only removed during the calculation of each pairwise correlation, while use="complete.obs", the matrix m first has all cases with missing values removed
# na.omit is listwise deletion (th whole row is deleted); na.exclude used the residuals and predictions are padded to the correct length by inserting NAs for cases omitted by na.exclude
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$masscale,
  method = "pearson",
  alternative = "less",
  na.action = na.exclude
)
cor.test(
  df_complete_F$log_contrast,
  df_complete_F$femscale,
  method = "pearson",
  alternative = "greater",
  na.action = na.exclude
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$mental_rot,
  method = "pearson",
  alternative = "less",
  na.action = na.exclude
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$masscale,
  method = "pearson",
  alternative = "less",
  na.action = na.exclude
)
cor.test(
  df_complete_F$log_motion,
  df_complete_F$femscale,
  method = "pearson",
  alternative = "greater",
  na.action = na.exclude
)
```


### Males

```{r}
cor.test(
  df_complete_M$log_contrast,
  df_complete_M$mental_rot,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_M$log_contrast,
  df_complete_M$masscale,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_M$log_contrast,
  df_complete_M$femscale,
  method = "pearson",
  alternative = "greater"
)
cor.test(
  df_complete_M$log_motion,
  df_complete_M$mental_rot,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_M$log_motion,
  df_complete_M$masscale,
  method = "pearson",
  alternative = "less"
)
cor.test(
  df_complete_M$log_motion,
  df_complete_M$femscale,
  method = "pearson",
  alternative = "greater"
)
```

## Correlation matrix

### Females

Select the females, focus on the numeric scores, and calculate a correlation matrix.

```{r}
df_corr_F <- df_complete_F %>%
  dplyr::select(.,-Sex)

corr_F <- Hmisc::rcorr(as.matrix(df_corr_F), type = c("pearson"))
```

#### Coefficients

```{r}
corr_F$r
```

#### P values

```{r}
corr_F$P
```

```{r}
# Get some colors
col <- colorRampPalette(c("blue", "white", "red"))(20)
heatmap(x = corr_F$r, col = col, symm = TRUE)
```

### Males

Select the males and focus on the numeric scores.

```{r}
df_corr_m <- df_complete %>%
  dplyr::filter(., Sex == 'Males') %>%
  dplyr::select(., -Sex)

corr_M <- Hmisc::rcorr(as.matrix(df_corr_m), type = c("pearson"))
```

#### Coefficients

```{r}
corr_M$r
```

#### P values

```{r}
corr_M$P
```

```{r}
# Get some colors
heatmap(x = corr_M$r, col = col, symm = TRUE)
```

### Further exclusions

Evaluating the impact of two male outliers even after the 3 SD exclusion.

```{r}
out.m <- lapply(df_complete_M[, 3:4], FindOutliers)
out.f <- lapply(df_complete_F[, 3:4], FindOutliers)

df_complete_M2 <-
  df_complete_M[-which(df_complete_M$log_motion > -2),]
df_test <- rbind(df_complete_M2, df_complete_F)
df_complete2 <- df_test[stats::complete.cases(df_test),]
```

### Overall for the outlier-excluded datasets

```{r}
df_corr2 <- df_complete2 %>%
  dplyr::select(.,-Sex)

corr_all <- Hmisc::rcorr(as.matrix(df_corr2), type = c("pearson"))

corr_all
```

# Visualizations

## Define helper functions

We create several functions to make our graphs have similar appearance.

```{r}
sex_diff_scatter <-
  function(df,
           x_var,
           y_var,
           x_rev = FALSE,
           y_rev = FALSE,
           an_f = "",
           an_m = "",
           anx = NULL,
           any = NULL,
           x_lab = "X axis",
           y_lab = "Y axis",
           square_axis = TRUE) {
    require(tidyverse)
    require(ggExtra)
    
    x_var_s <- sym(x_var)
    y_var_s <- sym(y_var)
    
    p <- ggplot(df) +
      aes(
        x = !!x_var_s,
        y = !!y_var_s,
        group = Sex,
        color = Sex
      ) +
      geom_point() +
      xlab(x_var) +
      ylab(y_var) +
      stat_smooth(method = "lm", na.rm = TRUE) +
      theme_classic2() +
      theme(legend.position = "bottom",
            legend.title = element_blank()) +
      xlab(x_lab) +
      ylab(y_lab) +
      annotate(
        "text",
        x = anx,
        y = any,
        label = c(an_f, an_m),
        color = c('red', 'darkturquoise')
      )
    
    if (square_axis)
    {
      p + coord_fixed()
    }
    
    if (stringr::str_detect(x_var, 'hobbies')) {
      p <- p + xlim(1, 5)
    }
    if (stringr::str_detect(y_var, 'hobbies')) {
      p <- p + ylim(1, 5)
    }
    
    # Reverse scale for threshold measures?
    if (x_rev)
      p <- p + scale_x_reverse()
    if (y_rev)
      p <- p + scale_y_reverse()
    
    p1 <- ggExtra::ggMarginal(p,
                              type = "density",
                              margins = "both",
                              groupFill = TRUE)
    p1
  }
```


```{r sex-diff-corr-sum-function}
sex_diff_corr_summ <- function(x_var, y_var, print_table = TRUE, 
                               corr_all_df = corr_all,
                               corr_M_df = corr_M,
                               corr_F_df = corr_F) {
  require(tidyverse) # for %>%
  
  corr_all_df <- tibble::tibble(
    cor_coef = corr_all_df$r[x_var, y_var],
    p_val = corr_all_df$P[x_var, y_var],
    n =  corr_all_df$n[x_var, y_var],
    pop = "Both"
  )
  males_df <- tibble::tibble(
    cor_coef = corr_M_df$r[x_var, y_var],
    p_val = corr_M_df$P[x_var, y_var],
    n =  corr_M_df$n[x_var, y_var],
    pop = "Males"
  )
  
  females_df <- tibble::tibble(
    cor_coef = corr_F_df$r[x_var, y_var],
    p_val = corr_F_df$P[x_var, y_var],
    n =  corr_F_df$n[x_var, y_var],
    pop = "Females"
  )
  
  df <- rbind(corr_all_df, males_df, females_df)
  
  df <- df %>%
    mutate(., stars = if_else(p_val < .005, "***",
                              if_else(
                                p_val < .01, "**",
                                if_else(p_val < .05, "*", " ns")
                              )))
  
  
  if (print_table) {
    kableExtra::kable(df, format = 'html') %>%
      kableExtra::kable_styling()
  } else {
    df
  }
}
```

## Motion sensitivity & contrast sensitivity

```{r motion-duration-contrast-sens}
corr_df <- sex_diff_corr_summ("log_motion",
                              "log_contrast", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "log_contrast",
  x_rev = TRUE,
  y_rev = TRUE,
  # "r=0.22*",
  # "r=0.54***",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.9, -2.04),
  c(-1.4, -1.98),
  "log(motion threshold)",
  "log(contrast threshold)"
)

sex_diff_corr_summ("log_motion",
                   "log_contrast")
```

## Motion sensitivity & mental rotation

```{r motion-duration-mental-rot}
corr_df <- sex_diff_corr_summ("log_motion",
                              "mental_rot", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "mental_rot",
  x_rev = TRUE,
  y_rev = FALSE,
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.8,-1.9),
  c(30, 36),
  "log(motion threshold)",
  "Mental rotation score"
)

sex_diff_corr_summ("log_motion", "mental_rot")
```

## Motion sensitivity & vocabulary

```{r motion-duration-vocab}
corr_df <- sex_diff_corr_summ("log_motion", "vocab",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "vocab",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = 0.18",
  # "r=0.22",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-2.25),
  c(25, 23),
  "log(motion threshold)",
  "Vocabulary score"
)
sex_diff_corr_summ("log_motion", "vocab")
```

## Motion sensitivity & feminine hobbies

### Unscaled

```{r motion-dur-fem-hobbies}
corr_df <- sex_diff_corr_summ("log_motion", "Feminine_hobbies",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "Feminine_hobbies",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = 0.17*",
  # "r = -0.01",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-2, -2.4),
  c(4.5, 1.8),
  "log(motion threshold)",
  "Interest in feminine hobbies"
)

sex_diff_corr_summ("log_motion", "Feminine_hobbies")
```

### Scaled

```{r motion-sens-fem-hobbies-scaled}
corr_df <- sex_diff_corr_summ("log_motion", "femscale",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "femscale",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = 0.17*",
  # "r = -0.01",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-2,-2.4),
  c(1, -1),
  "log(motion threshold)",
  "Interest in feminine hobbies"
)

sex_diff_corr_summ("log_motion", "femscale")
```

## Motion sensitivity & masculine hobbies

### Unscaled

```{r motion-dur-m-hobbies}
corr_df <- sex_diff_corr_summ("log_motion", "Masculine_hobbies",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "Masculine_hobbies",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = 0.17*",
  # "r = -0.01",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-2, -2.4),
  c(4.5, 1.8),
  "log(motion threshold)",
  "Interest in masculine hobbies"
)

sex_diff_corr_summ("log_motion", "Masculine_hobbies")
```

### Scaled

```{r motion-sens-masc-hobbies-scaled}
corr_df <- sex_diff_corr_summ("log_motion", "masscale",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_motion",
  "masscale",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = 0.17*",
  # "r = -0.01",
  paste0("r = ", format(corr_df$cor_coef[3], digits = 2, nsmall = 2), corr_df$stars[3]),
  paste0("r = ", format(corr_df$cor_coef[2], digits = 2, nsmall = 2), corr_df$stars[2]),
  c(-1.5,-2.4),
  c(-1, 1),
  "log(motion threshold)",
  "Interest in male_typed hobbies"
)

sex_diff_corr_summ("log_motion", "masscale")
```

## Contrast sensitivity & mental rotation

```{r contrast-sens-mental-rot}
corr_df <- sex_diff_corr_summ("log_contrast", "mental_rot",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_contrast",
  "mental_rot",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = -0.19*",
  # "r = 0.12",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.5),
  c(33, 35),
  "log(contrast threshold)",
  "Mental rotation score"
)
sex_diff_corr_summ("log_contrast", "mental_rot")
```

## Contrast sensitivity & feminine hobbies

### Unscaled

```{r contrast-sens-f-hobbies}
corr_df <- sex_diff_corr_summ("log_contrast", "Feminine_hobbies",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_contrast",
  "Feminine_hobbies",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = -0.19*",
  # "r = 0.26",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.5),
  c(1.5, 4.2),
  "log(contrast threshold)",
  "Interest in feminine hobbies"
)

sex_diff_corr_summ("log_contrast", "Feminine_hobbies")
```

### Scaled

```{r contrast-sens-f-hobbies-scaled}
corr_df <- sex_diff_corr_summ("log_contrast", "femscale",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_contrast",
  "femscale",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = -0.19*",
  # "r = 0.26",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.5),
  c(1.5, 4.2),
  "log(contrast threshold)",
  "Interest in feminine hobbies"
)

sex_diff_corr_summ("log_contrast", "femscale")
```

## Contrast sensitivity & masculine hobbies

### Unscaled

```{r contrast-sens-m-hobbies}
corr_df <- sex_diff_corr_summ("log_contrast", "Masculine_hobbies",
                              print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  "log_contrast",
  "Masculine_hobbies",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = -0.19*",
  # "r = 0.26",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.5),
  c(1.5, 4.2),
  "log(contrast threshold)",
  "Interest in masculine hobbies"
)
sex_diff_corr_summ("log_contrast", "Masculine_hobbies")
```

### Scaled

```{r contrast-sens-m-hobbies-scaled}
corr_df <- sex_diff_corr_summ("log_contrast", "masscale",
                              print_table = FALSE)
sex_diff_scatter(
  df_complete2,
  "log_contrast",
  "masscale",
  x_rev = TRUE,
  y_rev = FALSE,
  # "r = -0.19*",
  # "r = 0.26",
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  c(-1.5),
  c(1.5, 4.2),
  "log(contrast threshold)",
  "Interest in masculine hobbies"
)
sex_diff_corr_summ("log_contrast", "masscale")
```

## Masculine and feminine hobbies

### Unscaled

```{r m-hobbies-f-hobbies}
corr_df <-
  sex_diff_corr_summ("Masculine_hobbies", "Feminine_hobbies", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  x_var = "Masculine_hobbies",
  y_var = "Feminine_hobbies",
  x_rev = FALSE,
  y_rev = FALSE,
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  anx = 3,
  any = c(1.9, 1.6),
  "Interest in masculine hobbies",
  "Interest in feminine hobbies"
)
sex_diff_corr_summ("Masculine_hobbies", "Feminine_hobbies")
```

### Scaled

```{r m-hobbies-f-hobbies-scaled}
corr_df <-
  sex_diff_corr_summ("masscale", "femscale", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  x_var = "masscale",
  y_var = "femscale",
  x_rev = FALSE,
  y_rev = FALSE,
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  anx = 3,
  any = c(1.9, 1.6),
  "Interest in masculine hobbies",
  "Interest in feminine hobbies"
)
sex_diff_corr_summ("masscale", "femscale")
```

## Mental rotation & (scaled) hobbies

### Feminine hobbies

```{r ment-rot-f-hobbies-scaled}
corr_df <-
  sex_diff_corr_summ("mental_rot", "femscale", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  x_var = "mental_rot",
  y_var = "femscale",
  x_rev = FALSE,
  y_rev = FALSE,
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  anx = 25,
  any = c(1,-1),
  "mental rotation",
  "Interest in feminine hobbies"
)
sex_diff_corr_summ("mental_rot", "femscale")
```

### Masculine hobbies

```{r ment-rot-m-hobbies-scaled}
corr_df <-
  sex_diff_corr_summ("mental_rot", "masscale", print_table = FALSE)

sex_diff_scatter(
  df_complete2,
  x_var = "mental_rot",
  y_var = "masscale",
  x_rev = FALSE,
  y_rev = FALSE,
  paste0(
    "r = ",
    format(corr_df$cor_coef[3], digits = 2, nsmall = 2),
    corr_df$stars[3]
  ),
  paste0(
    "r = ",
    format(corr_df$cor_coef[2], digits = 2, nsmall = 2),
    corr_df$stars[2]
  ),
  anx = 25,
  any = c(1,-1),
  "mental rotation",
  "Interest in masculine hobbies"
)
sex_diff_corr_summ("mental_rot", "masscale")
```

# Does vision account for mental rotation?

There are two approaches to answering this question.
One looks for sex differences in the residuals of the models `mental rotation ~ contrast` and `mental rotation ~ motion`.
The other models `mental rotation ~ contrast + sex + contrast:sex` and determines whether adding the `sex` term provides a better fit relative to `mental rotation ~ contrast` alone. 

## Residuals-based approach

We'll take evaluate the first approach using residuals.

### Contrast

Focus on the log contrast sensitivity threshold data.

```{r}
# Select relevant data from data frame.
df_mr_log_contr <- df_complete2 %>%
  dplyr::select(., Sex, log_contrast, mental_rot)
```

Visualize mental rotation scores.

```{r}
df_mr_log_contr %>%
  ggplot(.) +
  aes(Sex, mental_rot, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

```{r}
t.test(
  mental_rot ~ Sex,
  data = df_complete2,
  var.equal = TRUE,
  alternative = "less"
)
```

Mental rotation scores differ between males and females.

Fit `mental_rot ~ log_contrast`.

```{r}
lm_mr_log_contr <- lm(mental_rot ~ log_contrast, df_mr_log_contr)
summary(lm_mr_log_contr)
```

Extract the residuals and fit `mr_resids ~ Sex`.

```{r}
resids <- resid(lm_mr_log_contr)
df_mr_resids <- data.frame(mr_resids = resids, Sex = df_mr_log_contr$Sex)
lm_mr_resids_sex <- lm(mr_resids ~ Sex, df_mr_resids)
summary(lm_mr_resids_sex)
```

Plot to visualize.

```{r}
df_mr_resids %>%
  ggplot(.) +
  aes(Sex, mr_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for differences in means.

```{r}
t.test(
  mr_resids ~ Sex,
  data = df_mr_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

So, including contrast sensitivity reduces, but does not eliminate, a statistically significant difference in mental rotation scores by sex favoring men.

### Motion

```{r}
# Select relevant data from data frame.
df_mr_log_motion <- df_complete2 %>%
  dplyr::select(., Sex, log_motion, mental_rot)
```

Fit `mental_rot ~ log_cmotion`.

```{r}
lm_mr_log_motion <- lm(mental_rot ~ log_motion, df_mr_log_motion)
summary(lm_mr_log_motion)
```

Extract the residuals and fit `mr_resids ~ Sex`.

```{r}
resids <- resid(lm_mr_log_motion)
df_mr_resids <- data.frame(mr_resids = resids, Sex = df_mr_log_motion$Sex)
lm_mr_resids_sex <- lm(mr_resids ~ Sex, df_mr_resids)
summary(lm_mr_resids_sex)
```

Plot to visualize.

```{r}
df_mr_resids %>%
  ggplot(.) +
  aes(Sex, mr_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for mean differences.

```{r}
t.test(
  mr_resids ~ Sex,
  data = df_mr_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

So, including motion eliminates a statistically significant difference in mental rotation scores by sex favoring men.

## Combining vision measures

Let's see whether combining the vision measures can do even better in accounting for mental rotation.

```{r}
df_mr_contr_motion <- df_complete2 %>%
  dplyr::select(., Sex, log_contrast, log_motion, mental_rot)
```

Full model.

```{r}
lm_mr_contr_motion_full <- lm(mental_rot ~ log_contrast*log_motion*Sex, data = df_mr_contr_motion)
summary(lm_mr_contr_motion_full)
```

Drop interactions.

```{r}
lm_mr_contr_motion_no_interactions <- lm(mental_rot ~ log_contrast + log_motion + Sex, data = df_mr_contr_motion)
summary(lm_mr_contr_motion_no_interactions)
```

Drop sex.

```{r}
lm_mr_contr_motion_no_sex <- lm(mental_rot ~ log_contrast + log_motion, data = df_mr_contr_motion)
summary(lm_mr_contr_motion_no_sex)
```

Compare models.

```{r}
anova(lm_mr_contr_motion_no_sex, lm_mr_contr_motion_no_interactions)
```
So, the RSS down a bit, but not significantly. All things being equal, we'd choose the simpler model for parsimony reasons.

```{r}
lm_mr_only_sex <- lm(mental_rot ~ Sex, data = df_mr_contr_motion)
summary(lm_mr_only_sex)
```

Comparing models.

```{r}
anova(lm_mr_only_sex, lm_mr_contr_motion_no_sex)
```
The model with the smaller RSS is the one with the vision variables. And the .

# Does vision account for hobby choices?

We'll take the same approach as above.

## Feminine hobbies

### Contrast

```{r}
df_complete2 %>%
  ggplot(.) +
  aes(Sex, femscale, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Fit `femscale ~ log_contrast`.

```{r}
lm_femscale_log_contr <- lm(femscale ~ log_contrast, df_complete2)
summary(lm_femscale_log_contr)
```
Extract the residuals and fit `femscale_resids ~ Sex`.

```{r}
resids <- resid(lm_femscale_log_contr)
df_femscale_resids <- data.frame(femscale_resids = resids, Sex = df_complete2$Sex)
lm_femscale_resids_sex <- lm(femscale_resids ~ Sex, df_femscale_resids)
summary(lm_femscale_resids_sex)
```
Plot to visualize.

```{r}
df_femscale_resids %>%
  ggplot(.) +
  aes(Sex, femscale_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for mean differences.

```{r}
t.test(
  femscale_resids ~ Sex,
  data = df_femscale_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

Accounting for `log_contrast` does NOT eliminate the sex difference in `femscale`.

**NB: This workflow should be packaged in a function to reduce the likelihood of errors.**

### Motion

Fit `femscale ~ log_motion`.

```{r}
lm_femscale_log_motion <- lm(femscale ~ log_motion, df_complete2)
summary(lm_femscale_log_motion)
```

Extract the residuals and fit `femscale_resids ~ Sex`.

```{r}
resids <- resid(lm_femscale_log_motion)
df_femscale_resids <- data.frame(femscale_resids = resids, Sex = df_complete2$Sex)
lm_femscale_resids_sex <- lm(femscale_resids ~ Sex, df_femscale_resids)
summary(lm_femscale_resids_sex)
```

Plot to visualize.

```{r}
df_femscale_resids %>%
  ggplot(.) +
  aes(Sex, femscale_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for mean differences.

```{r}
t.test(
  femscale_resids ~ Sex,
  data = df_femscale_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

Motion thresholds do *not* eliminate sex differences in `femscale`.

### Combining contrast and motion

For simplicity, we will compare a model with `Sex` alone to one with both vision measures.

```{r}
lm_femscale_vision <- lm(femscale ~ log_contrast + log_motion, df_complete2)
lm_femscale_sex <- lm(femscale ~ Sex, df_complete2)
anova(lm_femscale_sex, lm_femscale_vision)
```
The RSS goes up with the model including the vision measures.

```{r}
summary(lm_femscale_sex)
```

Vision measures are *not* a better predictor of `femscales` than `Sex` alone.

## Masculine hobbies

```{r}
df_complete2 %>%
  ggplot(.) +
  aes(Sex, masscale, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

### Contrast

Fit `masscale ~ log_contrast`.

```{r}
lm_masscale_log_contrast <- lm(masscale ~ log_contrast, df_complete2)
summary(lm_masscale_log_contrast)
```

Extract the residuals and fit `masscale_resids ~ Sex`.

```{r}
resids <- resid(lm_masscale_log_contrast)
df_masscale_resids <- data.frame(masscale_resids = resids, Sex = df_complete2$Sex)
lm_masscale_resids_sex <- lm(masscale_resids ~ Sex, df_masscale_resids)
summary(lm_masscale_resids_sex)
```


```{r}
df_masscale_resids %>%
  ggplot(.) +
  aes(Sex, masscale_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for mean differences.

```{r}
t.test(
  masscale_resids ~ Sex,
  data = df_masscale_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

Contrast sensitivity does *not* account for `masscale`.

### Motion

Fit `masscale ~ log_motion`.

```{r}
lm_masscale_log_motion <- lm(masscale ~ log_motion, df_complete2)
summary(lm_masscale_log_motion)
```

Extract the residuals and fit `masscale_resids ~ Sex`.

```{r}
resids <- resid(lm_masscale_log_motion)
df_masscale_resids <- data.frame(masscale_resids = resids, Sex = df_complete2$Sex)
lm_masscale_resids_sex <- lm(masscale_resids ~ Sex, df_masscale_resids)
summary(lm_masscale_resids_sex)
```


```{r}
df_masscale_resids %>%
  ggplot(.) +
  aes(Sex, masscale_resids, color = Sex, alpha = 0.3) +
  geom_boxplot() +
  geom_violin() +
  geom_point() +
  theme(legend.position = "none")
```

Test for mean differences.

```{r}
t.test(
  masscale_resids ~ Sex,
  data = df_masscale_resids,
  var.equal = TRUE,
  alternative = "less"
)
```

Motion sensitivity does *not* account for `masscale`.

### Combining contrast and motion

For simplicity, we will compare a model with `Sex` alone to one with both vision measures.

```{r}
lm_masscale_vision <- lm(masscale ~ log_contrast + log_motion, df_complete2)
lm_masscale_sex <- lm(masscale ~ Sex, df_complete2)
anova(lm_masscale_sex, lm_masscale_vision)
```


The RSS goes *up* with the more complex model. The increase is not statistically significant, and so we choose the simpler model with `Sex` alone.

```{r}
summary(lm_masscale_vision)
summary(lm_masscale_sex)
```

Again, `Sex` is a better predictor of `masscale` than the combined vision measures.

# Mediation analysis

The following reference may be useful for some (it was for ROG):

https://towardsdatascience.com/doing-and-reporting-your-first-mediation-analysis-in-r-2fe423b92171

```{r}
library(mediation)
```

### Feminine_hobbies -> motion_dur_thr -> mental_rot

```{r}
# Step #1: The total effect
fit.totaleffect = lm(mental_rot ~ femscale + vocab + Sex, df2)
summary(fit.totaleffect) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator = lm(log_motion ~ femscale + Sex, df2)
summary(fit.mediator) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv = lm(mental_rot ~ log_motion + femscale + vocab + Sex, df2)
summary(fit.dv) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results = mediate(
  fit.mediator,
  fit.dv,
  treat = 'femscale',
  mediator =
    'log_motion',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results)
# not significant ACME is boot=T
```


```{r}
# Step #1: The total effect
fit.totaleffect = lm(mental_rot ~ femscale + Sex, df2)
summary(fit.totaleffect) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator = lm(log_motion ~ femscale + Sex, df2)
summary(fit.mediator) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv = lm(mental_rot ~ log_motion + femscale + Sex, df2)
summary(fit.dv) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results = mediate(
  fit.mediator,
  fit.dv,
  treat = 'femscale',
  mediator =
    'log_motion',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results)
# not significant ACME is boot=T
```


```{r}
# Step #1: The total effect
fit.totaleffect3 = lm(mental_rot ~ femscale, df_complete_F)
summary(fit.totaleffect3) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator3 = lm(log_motion ~ femscale, df_complete_F)
summary(fit.mediator3) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv3 = lm(mental_rot ~ log_motion + femscale, df_complete_F)
summary(fit.dv3) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results3 = mediate(
  fit.mediator3,
  fit.dv3,
  treat = 'femscale',
  mediator =
    'log_motion',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results3)
# not significant ACME is boot=T
```


```{r}
# Step #1: The total effect
fit.totaleffect4 = lm(mental_rot ~ femscale + vocab, df_complete_F)
summary(fit.totaleffect4) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator4 = lm(log_motion ~ femscale, df_complete_F)
summary(fit.mediator4) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv4 = lm(mental_rot ~ log_motion + femscale + vocab, df_complete_F)
summary(fit.dv4) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results4 = mediate(
  fit.mediator4,
  fit.dv4,
  treat = 'femscale',
  mediator =
    'log_motion',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results4)
# not significant ACME is boot=T
```

### Feminine_hobbies ->contrast->mental_rot

```{r}
# Step #1: The total effect
fit.totaleffect = lm(mental_rot ~ femscale + vocab + Sex, df_complete)
summary(fit.totaleffect) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator = lm(log_contrast ~ femscale + Sex, df_complete)
summary(fit.mediator) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv = lm(mental_rot ~ log_contrast + femscale + vocab + Sex, df_complete)
summary(fit.dv) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results = mediate(
  fit.mediator,
  fit.dv,
  treat = 'femscale',
  mediator =
    'log_contrast',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results)

summary(lm(mental_rot ~ log_contrast + vocab + Sex, df_complete))
# summary(lm(mental_rot ~ log_contrast +Sex, df2))
# significant ACME 
```


```{r}
# Step #1: The total effect
fit.totaleffect = lm(mental_rot ~ femscale + vocab + Sex, df2)
summary(fit.totaleffect) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator = lm(log_contrast ~ femscale + Sex, df2)
summary(fit.mediator) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv = lm(mental_rot ~ log_contrast + femscale + vocab + Sex, df2)
summary(fit.dv) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results = mediate(
  fit.mediator,
  fit.dv,
  treat = 'femscale',
  mediator =
    'log_contrast',
  boot = T
) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results)

summary(lm(mental_rot ~ log_contrast + vocab + Sex, df2))
# summary(lm(mental_rot ~ log_contrast +Sex, df2))
# significant ACME 
```


```{r}
# Step #1: The total effect
fit.totaleffect8 = lm(mental_rot ~ femscale+Sex, df2)
summary(fit.totaleffect8) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator8 = lm(log_contrast ~ femscale+Sex, df2)
summary(fit.mediator8) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv8 = lm(mental_rot ~ log_contrast + femscale+Sex, df2)
summary(fit.dv8) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results8 = mediate(fit.mediator8, fit.dv8, treat = 'femscale', mediator =
                    'log_contrast', boot=T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results8)
# significant ACME 
```


```{r}
# Step #1: The total effect
fit.totaleffect = lm(mental_rot ~ femscale+vocab, df_complete_F)
summary(fit.totaleffect) # As you can see, the total effect of f hobbies on our dv is significant (p<.05).
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator = lm(log_contrast ~ femscale,df_complete_F)
summary(fit.mediator) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv = lm(mental_rot ~ log_contrast + femscale+vocab, df_complete_F)
summary(fit.dv) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results = mediate(fit.mediator, fit.dv, treat = 'femscale', mediator =
                    'log_contrast', boot=T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results)

summary(lm(mental_rot ~ log_contrast +vocab, df_complete_F))
# summary(lm(mental_rot ~ log_contrast +Sex, df2))
# significant ACME 
```
```{r}
# Step #1: The total effect
# Step #2: The effect of the IV onto the mediator
# To establish any mediation, the independent variable (iv, “sepal length” in our case) must significantly affect the mediator. This is logical as, without any effect here, no mediation can take place.
fit.mediator5 = lm(log_contrast ~ femscale, df_complete_F)
summary(fit.mediator5) # the total effect of f hobbies on our MRT is significant (p<.05).
# Step #3: The effect of the mediator on the dependent variable
fit.dv5 = lm(mental_rot ~ log_contrast + femscale+vocab, df_complete_F)
summary(fit.dv5) # The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results5 = mediate(fit.mediator5, fit.dv5, treat = 'femscale', mediator =
                    'log_contrast', boot=T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results5)
# not significant ACME is boot=T
```


>> ACME stands for average causal mediation effects. This is the indirect effect of the IV (sepal length) on the DV (likelihood of pollination) that goes through the mediator (attractiveness to bee). Note that it estimated this effect to be -.50 — this is exactly X (the effect of the IV on the mediator from step #2) times X (the mediator's effect on the DV from step #3) — so not necessarily new information. However, what is new, is that we now have a confidence interval and significance levels for the entire indirect effect, not only its two parts. This is something we need for reporting the mediation.
ADE stands for average direct effects. It describes the direct effect of the IV on the DV. Again — if you’ve been paying attention closely — this is not new information. We have calculated this effect before in step #3: the direct effect of the IV on the DV when controlling for the mediator.
Total Effect stands for the total effect (direct + indirect) of the IV on the DV. This also isn’t new information. We calculated this in step #1. We can also get it by simply adding the ACME (.113) and the ADE (.019) to receive the total effect of .13. We also already knew that the total effect was significant from step #1.
Prop. Mediated describes the proportion of the effect of the IV on the DV that goes through the mediator. It’s calculated by dividing the ACME (-0.50) by the total effect (-3.41) to receive .14. This piece of information is a nice tidbit but not necessarily the focus of our interest.


###  log_motion -> Feminine_hobbies -> mental_rot

```{r}
fit.t4 = lm(mental_rot ~ log_motion + vocab + Sex, df2)
summary(fit.t4)
fit.Y4 = lm(mental_rot ~ femscale + log_motion + vocab + Sex, df2)
summary(fit.Y4)
fit.M4 = lm(femscale ~ log_motion + Sex, df2)
summary(fit.M4) # the total effect of f hobbies on our MRT is significant (p<.05).
# gvlma(fit.M)
# Step #3: The effect of the mediator on the dependent variable
# The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results6 = mediate(fit.M4,
                   fit.Y4,
                   treat = 'log_motion',
                   mediator = 'femscale',
                   boot = T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results6)
```


```{r}
fit.t4 = lm(mental_rot ~ log_motion + Sex, df2)
summary(fit.t4)
fit.Y4 = lm(mental_rot ~ femscale + log_motion + Sex, df2)
summary(fit.Y4)
fit.M4 = lm(femscale ~ log_motion + Sex, df2)
summary(fit.M4) # the total effect of f hobbies on our MRT is significant (p<.05).
# gvlma(fit.M)
# Step #3: The effect of the mediator on the dependent variable
# The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results6 = mediate(fit.M4,
                   fit.Y4,
                   treat = 'log_motion',
                   mediator = 'femscale',
                   boot = T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results6)
```

###  log_contrast -> fem_hobbies -> mental_rot

```{r}
fit.T5 = lm(mental_rot ~ log_contrast, df2)
summary(fit.T5)
fit.Y5 = lm(mental_rot ~ femscale + log_contrast, df2)
summary(fit.Y5)
fit.M5 = lm(femscale ~ log_contrast, df2)
summary(fit.M5) # the total effect of f hobbies on our MRT is significant (p<.05).
# gvlma(fit.M)
# Step #3: The effect of the mediator on the dependent variable
# The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results7 = mediate(fit.M5, fit.Y5, treat = 'log_contrast', mediator = 'femscale') # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results7)
summary(lm(mental_rot ~ femscale, df2))

# Sobel’s test
#sobel(df2$femscale, df2$log_contrast, df2$mental_rot) # (mv,iv,dv)
```

```{r}
fit.t4 = lm(mental_rot ~ log_contrast + Sex + vocab, df2)
summary(fit.t4)
fit.Y4 = lm(mental_rot ~ femscale + log_contrast + Sex + vocab, df2)
summary(fit.Y4)
fit.M4 = lm(femscale ~ log_contrast + Sex, df2)
summary(fit.M4) # the total effect of f hobbies on our MRT is significant (p<.05).
# gvlma(fit.M)
# Step #3: The effect of the mediator on the dependent variable
# The mediator has a significant effect (p<.05) on the dv.
# Step #4: Causal Mediation Analysis
results6 = mediate(fit.M4,
                   fit.Y4,
                   treat = 'log_contrast',
                   mediator = 'femscale',
                   boot = T) # Also, we need to specify boot=T as, by default, mediate will use a quasi-Bayesian approximation for confidence intervals. However, we want to report percentile confidence intervals, so we set it to T for true.
summary(results6)
```
